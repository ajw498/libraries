#!/bin/sh

OPENSSL=openssl-0.9.6g
NEON=neon-0.22.0
EXPAT=expat-1.95.4
ZLIB=zlib-1.1.4 
LIBPNG=libpng-1.2.0
REGEX=regex
LIBJPEG=jpeg-6b
LIBGD=gd-1.8.4
APR=apr
APRUTIL=apr-util

PREFIX=/home/riscos/cross/local

(cd $ZLIB; ./configure --prefix=$PREFIX \
&& make clean && make && make install) || exit 1

(cd $OPENSSL; ./Configure --prefix=$PREFIX -DNO_SYS_UN_H gcc) || exit 1

(cd $EXPAT; \
./configure --host=arm-riscos-aof --prefix=$PREFIX \
&& make clean && make && make install) || exit 1

(cd $LIBPNG; \
make clean && make PREFIX=$PREFIX && make install PREFIX=$PREFIX) || exit 1

(cd $LIBJPEG; \
./configure --host=arm-riscos-aof --prefix=$PREFIX \
&& make clean && make && make install-lib) || exit 1

(cd $LIBGD; \
make clean && make PREFIX=$PREFIX && make install PREFIX=$PREFIX) || exit 1

(cd $REGEX; \
make clean && make && make install PREFIX=$PREFIX) || exit 1

cat > $NEON/config.cache << EOF
ac_cv_prog_cc_g=\${ac_cv_prog_cc_g=no}
lt_cv_prog_cc_can_build_shared=\${lt_cv_prog_cc_can_build_shared=no}
lt_cv_prog_cc_pic_works=\${lt_cv_prog_cc_pic_works=no}
EOF

(cd $NEON; \
./configure --host=arm-riscos-aof -C --prefix=$PREFIX \
--with-libs=$PREFIX --with-force-zlib --with-ssl \
&& make clean && make && make install) || exit 1


cat > $APR/config.cache << EOF
ac_cv_prog_cc_g=\${ac_cv_prog_cc_g=no}
lt_cv_prog_cc_can_build_shared=\${lt_cv_prog_cc_can_build_shared=no}
lt_cv_prog_cc_pic_works=\${lt_cv_prog_cc_pic_works=no}
ac_cv_sizeof_off_t=${ac_cv_sizeof_off_t=4}
ac_cv_sizeof_pid_t=${ac_cv_sizeof_pid_t=4}
ac_cv_sizeof_size_t=${ac_cv_sizeof_size_t=4}
ac_cv_sizeof_ssize_t=${ac_cv_sizeof_ssize_t=4}
ac_cv_func_setpgrp_void=${ac_cv_func_setpgrp_void=no}
ac_cv_working_getnameinfo=${ac_cv_working_getnameinfo=no}
ac_cv_working_getaddrinfo=${ac_cv_working_getaddrinfo=no}
EOF

(cd $APR; \
./configure --host=arm-riscos-aof --prefix=$PREFIX -C \
&& make clean && make && make install) || exit 1

(cd $APRUTIL; \
./configure --host=arm-riscos-aof --prefix=$PREFIX \
--with-expat=$PREFIX --with-apr=../apr && \
make clean && \
touch uri/gen_uri_delims && \
touch uri/gen_uri_delims.lo && \
cp uri/uri_delims.h.pregen uri/uri_delims.h && \
touch uri/uri_delims.h && \
make && make install) || exit 1
